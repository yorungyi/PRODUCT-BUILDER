# 변경 이력 (Changelog)

## v2.2.0 (2026-01-29)

### 🆕 핵심 기능 추가

#### 1. 필터 적용 시 항상 총매출 표시 ⭐
- **기존 문제**: 특정 조건(당일/당월)에서만 총매출 박스 표시
- **개선사항**: **모든 필터 조건에서 자동으로 총매출 표시**
  - 점포별 필터 (클럽하우스만, 스타트하우스만 등)
  - 기간별 필터 (임의의 시작일~종료일)
  - 마감여부 필터 (미마감만, 마감완료만)
  - 모든 조합 필터

**사용 예시:**
```
✅ 전체 매출 조회 → 총매출: 9,702,000원 (13건)
✅ 클럽하우스만 필터 → 총매출: 1,227,000원 (4건)
✅ 2026-01-10 ~ 2026-01-15 기간 필터 → 총매출: 786,500원 (2건)
✅ 동그늘집 + 미마감 필터 → 해당 조건의 총매출 자동 계산
```

#### 2. 동시 접속 차단 기능 🔒
- **구현**: `active_sessions` 테이블 신규 생성 (migration 0003)
- **동작 방식**:
  - 로그인 시 기존 활성 세션 자동 종료
  - 한 직원당 1개 세션만 유지
  - 다른 장소에서 로그인 시 이전 세션 무효화
- **보안 강화**: 중복 로그인 방지로 계정 공유 차단
- **테스트 완료**: staff1 계정 동시 접속 차단 확인

#### 3. 데이터 영구 보관 정책 📦
- **정책**: 모든 매출 데이터 **절대 삭제 금지**
- **구현**: 
  - 마감 시 데이터 보호
  - 삭제 시 이력 추적
  - 날짜/연도 관계없이 누적 저장
- **현재 데이터**: 13건 (2026-01-02 ~ 2026-01-18)
- **보관 범위**: 일매출, 마감이력, 세션 로그 모두 영구 보관

### 🎯 매출내역 총매출 표시 로직
```
if (하루 조회) {
  → "당일 총매출" 박스 표시 (녹색)
} else if (당월 조회) {
  → "당월 총매출" 박스 표시 (파란색)
} else {
  → "기간별 총매출" 박스 표시 (파란색)
}

// 모든 경우에 필터된 매출의 합계 자동 계산
총매출 = 필터된 매출 합계
순매출 = 총매출 ÷ 1.1
부가세 = 총매출 - 순매출
```

### 🔧 기술 변경사항
- `public/static/app.js` - `loadSalesList()` 함수 로직 개선
- `src/routes/auth.ts` - 동시 로그인 차단 로직 추가
- `migrations/0003_add_active_sessions.sql` - 활성 세션 테이블 생성

### ✅ 테스트 결과
```bash
전체 매출 조회: 13건, 9,702,000원 ✅
클럽하우스 필터: 4건, 1,227,000원 ✅
동그늘집 필터: 0건, 0원 ✅
기간 필터(1/10~1/15): 2건, 786,500원 ✅
동시 접속 차단: staff1 중복 로그인 차단 확인 ✅
```

---

## v2.1.0 (2026-01-29)

### 🆕 새로운 기능

#### 1. 대시보드 당월 총매출 표시
- **위치**: 기간별 조회 섹션 우측 상단
- **내용**: 
  - 당월 총매출 (순매출 + 부가세)
  - 순매출과 부가세 구분 표시
  - 실시간 자동 계산
- **화면**: 큰 글씨로 강조 표시 (파란색)

#### 2. 매출 내역 당월 총매출 박스
- **조건**: 필터에서 이번 달 1일부터 조회 시 자동 표시
- **내용**: 
  - 당월 총매출 합계
  - 순매출과 부가세 구분
  - 4개 점포 합산
- **화면**: 녹색 그라데이션 박스로 강조

#### 3. 그래프 개선
- **변경 전**: 최근 7일 매출 추이 (라인 차트)
- **변경 후**: 당월 일별 매출 누적 (세로 막대 그래프)
- **특징**:
  - 4개 점포별 색상 구분
    - 🔵 클럽하우스 (파란색)
    - 🟢 스타트하우스 (녹색)
    - 🟠 동그늘집 (주황색)
    - 🟣 서그늘집 (보라색)
  - 일별 발생 매출 표시
  - 점포 간 비교 용이

### 🎯 사용 방법

#### 대시보드에서 당월 총매출 확인
1. 대시보드 탭 접속
2. 기간별 조회 우측 상단에서 당월 총매출 확인
3. 그래프에서 일별 점포별 매출 비교

#### 매출 내역에서 당월 총매출 확인
1. 매출 내역 탭 접속
2. 필터 날짜를 이번 달 1일 ~ 오늘로 설정
3. 필터 버튼 클릭
4. 당월 총매출 박스 자동 표시

### 📊 계산 방식
```
총매출 = 클럽하우스 + 스타트하우스 + 동그늘집 + 서그늘집
순매출 = 총매출 ÷ 1.1 (부가세 10% 제외)
부가세 = 총매출 - 순매출
```

---

## v2.0.0 (2026-01-29)

### 🆕 추가사항 5가지 완료

1. **날씨 체크 기능** (☀️맑음, ☁️흐림, 🌧️비, ❄️눈, 🚫휴장)
2. **당일 총매출 표시** (순매출+부가세 합계)
3. **직원 계정명 변경** (staff1, staff2)
4. **숫자 키패드** 형식 매출액 입력
5. **비밀번호 변경** 기능 (관리자/직원)

---

## v1.0.0 (2026-01-27)

### 🎉 초기 릴리즈

#### 핵심 기능
- JWT 인증 시스템
- 일매출 등록/수정/삭제
- 매출 마감 시스템
- 관리자 마감 해제
- 대시보드 (점포별 매출, 차트)
- 매출 내역 조회/필터
